# 🧲 Your.Gengi Augment Picker Overlay (LSA) — 최종 기획/개발 종합계획서 v1.0
> 전달 대상: **antigravity**  
> 최종 목표: **지금 화면에 뜬 증강 3개(새로고침 포함 시 최대 6개 후보)** 중에서, 내 챔피언/상황에 가장 잘 맞는 선택을 **오버레이로 즉시 추천**해주는 PC 프로그램  
> 운영 원칙: **합법/안전(읽기 전용)** + **무설치(Portable)** + **PC방 사용 가능** + **LoL 미설치 노트북에서는 Mock로 개발**

- 문서 버전: v1.0 (2026-02-17 KST)
- 현재 상태: “개발 거의 완료”, 남은 큰 문제는 **데이터(증강/아이템 메타) 확보/구조화**

---

## 1) 방향성(왜 이걸 만드나)
- OP.GG 같은 통계형(승률/픽률)은 **Alt+Tab**으로 보면 되지만, 게임 중에는 **불편/시간 손해/집중력 저하**가 큼.
- 그래서 “통계 서비스 복제”가 아니라, **게임 진행 흐름을 방해하지 않으면서**  
  **현재 선택지(3개)** 에서 **가장 좋은 선택을 골라주는** “선택 보조 오버레이”를 만든다.

---

## 2) 목표 / 비목표
### ✅ 목표(Goals)
1. **실시간 상태 감지**: ChampSelect / InProgress / EndOfGame에 맞춰 오버레이 자동 표시/숨김
2. **챔피언 자동 감지**(가능하면): 내 챔피언 ID를 읽어 추천 컨텍스트 구성
3. **증강 선택 보조(핵심)**  
   - 지금 뜬 3개 증강(사용자 선택/입력 기반) 중 **1~3순위 정렬**  
   - **추천 이유**(태그/시너지/카운터 논리)를 짧게 제시
4. **새로고침(리롤) 고려**  
   - 첫 세트(3개)를 보고 **리롤 권장 여부**를 안내(확률 기반 통계 없이, “현재 세트 품질 기준”으로)
   - 리롤 후 두 번째 세트(3개)도 동일하게 정렬  
   - 사용자 입장에서는 **최대 6개 후보를 검토한 효과**를 얻음(세트별로 추천을 즉시 제공)
5. **아이템 트리 추천(보조 기능)**: 코어 아이템 + 상황템을 간단히 표시
6. **PC방 무설치(Portable)**: 관리자 권한 없이 실행, 설정/데이터는 exe 폴더 우선 저장

### ❌ 비목표(Non-goals)
- 메모리 리딩/인젝션/스크립팅/자동 클릭/자동 입력 등 **게임 조작** 기능
- “승률(%)” 같은 **통계 수치 노출**
- 현재 화면에 보이지 않는 숨겨진 게임 정보를 제공하는 기능
- OP.GG처럼 전 챔피언/전 패치 통계를 유지하는 데이터 파이프라인

---

## 3) 컴플라이언스/안전 설계(중요)
### 절대 규칙(가드레일)
- **읽기 전용(Read-only)**: LCU/로컬 리소스 읽기만. 행동(POST/PATCH) 호출/게임 조작 금지
- **승률/통계 수치 표시 금지**: 추천은 **티어/태그/이유** 중심
- **정답 강요 UX 금지**: “무조건 이거”가 아니라 **추천 1순위 + 대안 2개 + 이유** 제공
- **민감정보 저장 금지**: lockfile password 등 인증정보 로그/디스크 저장 금지

---

## 4) 사용자 경험(UX) 플로우
### A) PC방 Real 사용 플로우(최종 사용)
1. LoL 클라이언트 실행
2. `LSA.exe` 실행 (USB/클라우드에서)
3. 앱이 자동으로 LCU 연결 → phase 감지
4. ChampSelect/증강 선택 타이밍에서 오버레이 표시
5. 사용자 행동(핵심):
   - 오버레이에서 **현재 뜬 증강 3개를 클릭/선택** (아이콘 또는 검색)
   - 즉시 **1~3순위 + 이유** 확인
   - 필요하면 **리롤**(게임에서 사용자가 직접) → 오버레이에서 “리롤 세트” 버튼 누르고 새 3개 선택 → 재정렬
6. 인게임에서는 축소 패널로 코어 아이템/상황템만 빠르게 확인
7. EndOfGame → 자동 숨김

### B) 노트북 Mock 개발 플로우(LoL 미설치)
- Mock game state(phase, championId, optional enemyTags)를 JSON/핫키로 바꿔가며 UI/추천 로직 개발
- “3개 증강 선택” UI는 그대로 테스트 가능

---

## 5) 핵심 기능 상세: “현재 3개(리롤 포함 최대 6개) 중 고르기”
### 5.1. 입력 방식(정책/기술 리스크 최소화)
- MVP/현재 버전은 **사용자 수동 선택** 방식으로 고정
  - 증강 카드 3개를 오버레이에서 “검색/아이콘”으로 빠르게 선택
- (향후) 자동 인식은 옵션으로만 검토(리스크/안정성 문제로 우선순위 낮음)

### 5.2. 세트 개념(리롤 포함)
- **Set A(초기 3개)**: 사용자 선택 → 즉시 추천 정렬
- **리롤 판단**: Set A의 최고 점수가 기준 이하이면 “리롤 권장” 표시
- **Set B(리롤 후 3개)**: 사용자 선택 → 즉시 추천 정렬
- 사용자 입장에서는 “최대 6개를 보고 의사결정한 것 같은 효과”를 얻음

> 주의: 실제 게임 규칙상 리롤이 이전 선택지를 유지하는지 여부와 무관하게,  
> **우리 앱은 ‘현재 보이는 3개’의 선택을 최적화**하는 도우미 역할만 한다.

### 5.3. 리롤 권장 로직(통계 없이도 가능한 방식)
- `bestScore(SetA) < rerollThreshold` 이면 “리롤 고려” 안내
- Threshold는 챔피언/역할에 따라 다르게(예: 스케일링 챔피언은 기준 높게)
- 추가 조건:
  - 이미 “핵심 시너지 태그”가 하나라도 있으면 리롤 보수적으로
  - “명백한 함정(내 챔피언과 상극 태그)”만 3개면 적극 리롤

---

## 6) 추천 엔진(데이터가 없어도 작동하도록 설계)
### 6.1. 추천 출력(표시용)
- Top 3 정렬 결과
  - `#1 추천` / `#2 대안` / `#3 선택 가능`
- 각 항목에 이유(최대 2줄):
  - “내 챔피언 시너지: on-hit / sustained DPS”
  - “상황 대응: anti-burst / survivability”

### 6.2. 스코어링(Explainable Scoring)
점수는 사용자에게 숫자로 노출하지 않고 내부값으로만 사용.

**기본식**
```
score = tierBase
      + champSynergyBonus
      + tagMatchBonus
      + counterBonus
      + antiSynergyPenalty
```
- `tierBase`: S/A/B/C → 100/80/60/40 같은 내부값(표시는 티어만)
- `champSynergyBonus`: 챔피언별 선호 태그/증강에 가산
- `tagMatchBonus`: 현재 빌드/플레이 스타일(역할 태그)에 맞으면 가산
- `counterBonus`: (가능한 경우) 상대 태그 기반 가산 (탱커 많음/힐러 있음 등)
- `antiSynergyPenalty`: 챔피언과 상극이면 감점

### 6.3. “데이터 문제”를 해결하는 현실적 설계(핵심)
- OP.GG 같은 통계 데이터를 복제하지 않는다.
- 대신 **증강/아이템의 “정적 사전 데이터”**는 자동 확보하고,
- “티어/태그/시너지”는 소량 수동 입력 + 점진 개선으로 운영한다.

---

## 7) 데이터 전략(합법 + 빠르게)
### 7.1. 우리가 반드시 필요한 데이터 종류
1) **정적 사전 데이터(자동화 가능)**
- 증강 목록/이름/설명/아이콘 경로
- 아이템 목록/이름/아이콘 (Data Dragon 사용 가능)
- 챔피언 목록/이름/아이콘 (Data Dragon 사용 가능)

2) **추천용 메타 데이터(수동/점진 개선)**
- 증강 태그(anti-heal, tank-killer, survivability…)
- 챔피언 선호 태그/가중치
- (선택) 간단한 상황 룰(적 탱커 많으면 tank-killer 우선 등)

### 7.2. 정적 “증강 사전” 자동 생성(최우선)
- PC방(LoL 설치)에서는 **LCU 로컬 게임 데이터**에서 `cherry-augments.json` 등 읽어 사전 생성
- 노트북(Mock 개발)에서는 **CommunityDragon 스냅샷**을 `data/`에 넣어 동일 스키마로 사용

결과: “증강 이름/설명/아이콘”을 **수동으로 입력할 필요가 거의 사라짐**

### 7.3. 메타 데이터(티어/태그)는 최소로 시작
- Day-1 목표:
  - 자주 나오는 증강 30~60개만 태그 달기
  - 내 주력 챔피언 5~10개만 선호 태그/가중치 세팅
- 이후 게임하면서 개선:
  - “선택 후 체감 좋았던 조합”을 JSON에 누적
  - 불필요한 데이터(전 챔피언 통계)는 만들지 않음

---

## 8) 기술 스택 / 아키텍처(Portable + 오버레이 최적)
### 8.1. 스택
- **C# / .NET 8**
- **WPF 오버레이**(TopMost/투명/클릭통과)
- 데이터: 로컬 JSON

### 8.2. 구성
```
LSA.App   : WPF Overlay UI, Hotkeys, Settings
LSA.Core  : Recommender(Scoring/Rules)
LSA.Lcu   : LCU 연결(Real provider)
LSA.Mock  : Mock provider
LSA.Data  : JSON 모델/로드/저장
```

### 8.3. 런타임 흐름
- Provider(Real/Mock) → GameStateService(phase state machine) → RecommendationService → Overlay UI 렌더

---

## 9) LCU 연동(Real) — 최소한만, 안전하게
### 9.1. 해야 하는 것
- `lockfile` 찾아서 port/password 파싱
- `GET /lol-gameflow/v1/gameflow-phase`로 phase 감지
- `GET /lol-champ-select/v1/session`에서 내 챔피언 ID 감지

### 9.2. 하지 말아야 하는 것
- 게임 조작/행동을 유발하는 요청(POST/PATCH 등)
- 토큰/패스워드 로그 저장

### 9.3. 실패 처리(PC방에서 중요)
- LCU 연결 실패 → 즉시 **Manual/Mock**로 폴백
- 앱이 크래시하면 안 됨(게임 영향 0)

---

## 10) 오버레이 UI 설계(선택이 빠르게)
### 10.1. 기본 레이아웃
- 상단 바: 상태(ChampSelect/InProgress), “MOCK” 표시, 설정 버튼
- 증강 패널:
  - “현재 3개 선택(슬롯 A/B/C)”
  - 검색 입력 + 결과 리스트(빠른 선택)
  - Top 3 추천 결과 + 이유
  - “리롤 세트 시작(Set B)” 버튼
- 아이템 패널(축소 가능):
  - 코어 3~6개 / 상황템 3~6개

### 10.2. 조작(핫키)
- 오버레이 토글: `Ctrl+Shift+O`
- 클릭통과 토글: `Ctrl+Shift+C`
- (개발용) Mock phase 순환: `Ctrl+Shift+P`
- Set B(리롤 세트) 시작: `Ctrl+Shift+R` (선택)

### 10.3. 클릭통과 정책
- 기본: 클릭 가능(선택 UI)
- 인게임: 클릭통과 ON 권장(방해 최소)
- 단, “증강 선택 타이밍”에는 클릭 가능 모드로 쉽게 전환 가능해야 함

---

## 11) Portable(PC방) 빌드/배포
### 11.1. 산출물
- `LSA.exe` (single-file)
- `data/knowledge_base.json`
- `data/augments_dictionary.json` (자동 생성/캐시)
- `config.json` (첫 실행 생성)
- `logs/`

### 11.2. publish 예시
```bash
dotnet publish src/LSA.App/LSA.App.csproj -c Release -r win-x64 ^
  -p:PublishSingleFile=true ^
  -p:SelfContained=true ^
  -p:IncludeNativeLibrariesForSelfExtract=true ^
  -p:PublishTrimmed=false
```

### 11.3. PC방 환경 주의
- 전체화면(독점)에서는 오버레이가 안 보일 수 있음 → **테두리 없는 창모드/창모드** 권장
- exe 폴더 쓰기 실패 시 설정 저장 위치 fallback:
  - 1순위: exe 폴더
  - 2순위: `%LOCALAPPDATA%\LSA\`

---

## 12) 테스트 플랜(실전 기준)
### 12.1. 노트북(Mock)
- phase 전환/챔피언 변경/증강 3개 선택 → 추천 즉시 갱신
- Set B(리롤 세트) 시작 → 새 3개 선택 → 재정렬
- config 저장/재시작 유지

### 12.2. PC방(Real)
- LoL 실행 → LSA 실행 → LCU 자동 연결 성공
- ChampSelect에서 내 챔피언 자동 감지
- 증강 선택 타이밍에서 “3개 선택→추천”이 빠르게 가능한지 확인
- 클릭통과/핫키 안정성 확인
- 종료 후 오버레이 정상 숨김

---

## 13) 남은 작업(“데이터” 중심 To-Do)
### 13.1. 정적 데이터 자동화(최우선)
- [ ] PC방에서 LCU 로컬 데이터로 “증강 사전” 자동 생성/캐시
- [ ] 노트북용 CommunityDragon 스냅샷을 동일 스키마로 로드

### 13.2. 메타 데이터 최소 세트 구축(오늘/내일 사용 목표)
- [ ] 주력 챔피언 5~10개: 선호 태그/가중치 입력
- [ ] 자주 보이는 증강 30~60개: 태그 입력
- [ ] 리롤 임계값 튜닝(너의 체감 기준으로)

### 13.3. UX 속도 최적화
- [ ] 증강 선택 UI “검색→엔터→슬롯 채우기”가 2~3초 내에 되도록
- [ ] 최근 선택 기록(autocomplete) 추가

---

## 14) antigravity에게 전달할 개발 협업 포인트
### 우리가 합의해야 할 핵심 결정 5가지
1) **증강 선택 입력 UX**: 검색 중심 vs 아이콘 그리드 중심 vs 혼합
2) **태그 스키마**: 태그 이름/개수/표준화(너무 많으면 관리 불가)
3) **리롤 기준**: 챔피언별 threshold/보수성(너의 체감 기반)
4) **UI 크기/배치**: PC방 해상도(1920x1080) 기준 안전 영역
5) **데이터 업데이트 방식**: JSON 직접 편집 vs 앱 내 간단 편집 UI

### 역할 분담 예시(추천)
- **antigravity**: UI/입력 UX(슬롯/검색/최근기록), 오버레이 안정화(클릭통과/핫키)
- **you**: 추천 로직(태그/가중치/리롤 룰), 지식베이스(태그링), Real LCU 연결/예외 처리

---

## 15) 부록: 데이터 파일 초안(스키마)
### 15.1. knowledge_base.json (메타/룰/챔피언 선호)
```json
{
  "meta": { "version": "1.0.0", "updatedAt": "2026-02-17" },
  "tags": {
    "tank_killer": { "label": "탱커 대응" },
    "anti_heal": { "label": "치유 감소" },
    "survivability": { "label": "생존" },
    "burst": { "label": "폭딜" },
    "poke": { "label": "포킹" }
  },
  "champions": {
    "145": {
      "name": "Kai'Sa",
      "preferredTags": { "dps": 20, "tank_killer": 15, "survivability": 10 },
      "avoidTags": { "support_only": -30 },
      "rerollThreshold": 75
    }
  },
  "rules": {
    "enemyTagWeights": {
      "tank": { "tank_killer": 25 },
      "heal": { "anti_heal": 20 },
      "burst": { "survivability": 15 }
    }
  }
}
```

### 15.2. augments_dictionary.json (정적 사전, 자동 생성 캐시)
```json
{
  "GiantSlayer": {
    "name": "Giant Slayer",
    "desc": "…",
    "icon": "path/or/url",
    "tags": ["tank_killer", "dps"]
  }
}
```

---

## 16) 결론(최종 정의)
- 이 프로젝트는 “통계 서비스”가 아니라 **선택 보조 도구**다.
- 데이터는 **정적 사전 자동화 + 최소 메타(태그/룰) 수동 입력**으로 해결한다.
- 결과물은 **무설치(Portable)**로 PC방에서 즉시 실행 가능해야 한다.
- 사용자에게는 “정답”을 강요하지 않고 **Top3 + 이유**로 빠른 의사결정을 돕는다.

